<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Solving Simultaneous Equations by Elimination</title>

  <style>
    /* ============================================================
      THEME TOKENS
    ============================================================ */
    :root {
      --top-bar-bg: #34495e;
      --bottom-bar-bg: #2c3e50;
      --page-bg: #f7f4e9;

      --card-bg: #ffffff;
      --card-border: #1f7ed0;

      --text-main: #1f2933;
      --text-muted: #ecf0f1;

      --pill-blue: #3498db;
      --pill-green: #27ae60;
      --pill-red: #e74c3c;
      --pill-purple: #8e44ad;
      --pill-yellow: #f1c40f;
      --pill-orange: #e67e22;

      --toolbar-icon-bg: #f1c40f;
      --toolbar-icon-border: #e0a708;

      --shadow-soft: 0 6px 18px rgba(0, 0, 0, 0.12);
      --radius-card: 18px;
      --radius-pill: 999px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--page-bg);
      color: var(--text-main);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ============================================================
      TOP BAR
    ============================================================ */
    .top-bar {
      background: var(--top-bar-bg);
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 24px;
      font-size: 14px;
    }
    .top-left { display: flex; flex-direction: column; gap: 6px; }
    .meta-row { display: flex; align-items: baseline; gap: 6px; }
    .meta-label { font-weight: 600; opacity: 0.9; }
    .meta-value {
      border-bottom: 2px solid rgba(236, 240, 241, 0.7);
      padding-bottom: 2px;
      font-weight: 500;
    }
    .top-right { display: flex; align-items: center; gap: 18px; font-weight: 500; }
    .page-info { white-space: nowrap; }

    .slide-select-wrapper { position: relative; }
    .slide-select {
      padding: 6px 28px 6px 10px;
      border-radius: 6px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      outline: none;
      background: #ffffff;
      color: #333;
      appearance: none;
    }
    .slide-select-wrapper::after {
      content: "‚ñæ";
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      pointer-events: none;
      color: #555;
    }

    /* ============================================================
      MAIN CONTENT AREA
    ============================================================ */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 40px 24px 40px;
      gap: 18px;
      position: relative;
    }

    /* ============================================================
      CARD COMPONENT
    ============================================================ */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      max-width: 900px;
      width: 100%;
      padding: 26px 34px 30px;
    }

    .card h1 {
      font-size: 30px;
      margin-bottom: 12px;
      font-weight: 800;
      color: #2c3e50;
    }

    .card p { font-size: 18px; line-height: 1.6; }

    .example-card p { font-size: 16px; line-height: 1.55; }

    .bullets {
      margin-top: 8px;
      padding-left: 18px;
      font-size: 18px;
      line-height: 1.6;
    }
    .bullets li { margin: 6px 0; }

    /* ============================================================
      CORE KNOWLEDGE LAYOUT
    ============================================================ */
    .core-knowledge-container {
      max-width: 900px;
      width: 100%;
    }

    .core-left {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 26px 34px 30px;
    }

    .core-left h1 {
      font-size: 28px;
      margin-bottom: 12px;
      font-weight: 800;
      color: #2c3e50;
    }

    /* Two purple boxes underneath */
    .purple-boxes-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 18px;
    }

    .purple-box {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid #9b59b6;
      box-shadow: var(--shadow-soft);
      padding: 20px 28px;
    }

    .purple-box h2 {
      font-size: 22px;
      font-weight: 800;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .purple-box .question-content {
      font-family: "Times New Roman", Times, serif;
      font-size: 36px;
      line-height: 1.3;
    }

    .purple-box .worked-solution {
      font-family: "Times New Roman", Times, serif;
      font-size: 32px;
      line-height: 1.5;
    }

    /* Green border for worked example box */
    .green-box {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid #27ae60;
      box-shadow: var(--shadow-soft);
      padding: 20px 28px;
    }

    .green-box h2 {
      font-size: 22px;
      font-weight: 800;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .green-box .worked-solution {
      font-family: "Times New Roman", Times, serif;
      font-size: 32px;
      line-height: 1.5;
    }

    /* Wider boxes for certain slides */
    .purple-boxes-container-wide {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 20px;
      margin-top: 18px;
    }

    /* Aligned equations */
    .equation-aligned {
      display: grid;
      grid-template-columns: auto auto auto;
      gap: 8px 12px;
      align-items: center;
      justify-content: start;
      font-family: "Times New Roman", Times, serif;
      font-size: 32px;
      line-height: 1.6;
      margin-top: 10px;
    }

    .equation-aligned .eq-left {
      text-align: right;
      justify-self: end;
    }

    .equation-aligned .eq-equals {
      text-align: center;
      justify-self: center;
    }

    .equation-aligned .eq-right {
      text-align: left;
      justify-self: start;
    }

    /* ============================================================
      TWO COLUMN TEACHER EXAMPLES
    ============================================================ */
    .teacher-examples-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      max-width: 1100px;
      width: 100%;
      margin-top: 18px;
    }

    .teacher-example-col {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      border: 3px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 20px 28px;
    }

    .teacher-example-col h2 {
      font-size: 22px;
      font-weight: 800;
      color: #2c3e50;
      margin-bottom: 12px;
    }

    /* ============================================================
      MATH TYPOGRAPHY
    ============================================================ */
    .math { font-size: 52px; line-height: 1.25; }
    .math i { font-style: italic; }
    .math sup { font-size: 60%; vertical-align: super; }

    .equation-line {
      display: flex;
      align-items: baseline;
      gap: 14px;
      margin: 22px 0;
    }

    /* ============================================================
      WORKED EXAMPLE GRID LAYOUT
    ============================================================ */
    .worked-example {
      display: grid;
      grid-template-columns: auto auto auto;
      gap: 8px 20px;
      align-items: baseline;
      justify-content: start;
      font-family: "Times New Roman", Times, serif;
      font-size: 36px;
      line-height: 1.4;
      margin-top: 12px;
    }

    .worked-example .lhs {
      text-align: right;
      justify-self: end;
      color: #000000;
    }

    .worked-example .sign {
      text-align: center;
      justify-self: center;
      min-width: 40px;
      color: #000000;
    }

    .worked-example .rhs {
      text-align: left;
      justify-self: start;
      color: #000000;
    }

    .worked-example .operation {
      font-size: 28px;
      color: #1f7ed0;
    }

    /* ============================================================
      QUESTION LABELS
    ============================================================ */
    .q-label {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 22px;
      font-weight: 800;
      color: #2c3e50;
      width: 44px;
      text-align: right;
      flex: 0 0 auto;
    }

    /* ============================================================
      MINI-WHITEBOARD (2x2 GRID - SPLIT INTO TWO SLIDES)
    ============================================================ */
    .questions-grid {
      max-width: 900px;
      width: 100%;
      padding: 0 34px;
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      column-gap: 120px;
      row-gap: 160px;
      justify-items: start;
    }

    .q-block {
      font-family: "Times New Roman", Times, serif;
      font-size: 52px;
      line-height: 1.25;
      display: flex;
      align-items: baseline;
      gap: 14px;
    }

    /* ============================================================
      EXAMPLE SLIDES (COLUMN LAYOUT)
    ============================================================ */
    .questions-cols {
      max-width: 900px;
      width: 100%;
      padding: 0 34px;
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      column-gap: 120px;
      row-gap: 70px;
      justify-items: start;
    }

    .q-col {
      display: flex;
      align-items: baseline;
      gap: 14px;
    }

    .q-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-width: 0;
    }

    .q-main {
      font-family: "Times New Roman", Times, serif;
      font-size: 52px;
      line-height: 1.25;
    }

    .q-sub {
      font-family: "Times New Roman", Times, serif;
      font-size: 34px;
      line-height: 1.25;
    }

    .q-col.placeholder { opacity: 0; pointer-events: none; }

    /* ============================================================
      FINAL REVIEW SLIDE
    ============================================================ */
    .review-slide {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 14px;
      margin-top: 6px;
    }

    .review-title {
      border: 3px solid #f59e0b;
      background: #fff7ed;
      color: #c2410c;
      font-size: 26px;
      font-weight: 900;
      padding: 14px 18px;
      border-radius: 12px;
      box-shadow: var(--shadow-soft);
      width: 100%;
      max-width: 900px;
    }

    .review-box {
      border: 3px solid #3b82f6;
      background: #ffffff;
      padding: 16px 18px;
      border-radius: 12px;
      font-size: 18px;
      line-height: 1.5;
      box-shadow: var(--shadow-soft);
      width: 100%;
      max-width: 900px;
    }

    .review-box strong { font-weight: 900; }

    .review-example {
      margin-top: 8px;
      text-align: center;
      font-family: "Times New Roman", Times, serif;
      font-size: 28px;
      font-weight: 700;
    }

    .apply-task {
      border: 3px solid #16a34a;
      background: #ecfdf5;
      padding: 20px 18px;
      border-radius: 14px;
      box-shadow: var(--shadow-soft);
      width: 100%;
      max-width: 900px;
      text-align: center;
    }
    .apply-task h2 {
      color: #166534;
      font-size: 32px;
      margin-bottom: 8px;
      font-weight: 900;
    }
    .apply-task p {
      font-size: 20px;
      color: #14532d;
      font-weight: 700;
    }

    /* ============================================================
      TIMER WIDGET
    ============================================================ */
    .timer-widget {
      position: absolute;
      left: 24px;
      top: 110px;
      width: 260px;
      background: #111;
      color: #fff;
      border-radius: 14px;
      padding: 18px 16px 16px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.18);
      border: 3px solid #0ea5e9;
      user-select: none;
      z-index: 5;
      cursor: grab;
    }
    .timer-widget:active { cursor: grabbing; }

    .timer-display {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 48px;
      letter-spacing: 2px;
      text-align: center;
      margin-bottom: 12px;
    }
    .timer-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 12px;
    }
    .timer-btn {
      background: #2d9cdb;
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 8px 12px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }
    .timer-btn:active { transform: translateY(1px); }
    .timer-inputs {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-weight: 700;
    }
    .timer-inputs label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
    }
    .timer-inputs input {
      width: 56px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 2px solid rgba(255,255,255,0.25);
      outline: none;
      font-weight: 800;
      text-align: center;
      background: #fff;
      color: #111;
    }

    /* ============================================================
      DRAWING CANVAS OVERLAY
    ============================================================ */
    #drawCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    /* ============================================================
      BOTTOM TOOLBAR - UPDATED STYLES
    ============================================================ */
    .toolbar {
      background: var(--bottom-bar-bg);
      color: var(--text-muted);
      padding: 10px 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      flex-wrap: wrap;
    }
    .toolbar-left, .toolbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .tool-button, .pill-button {
      border: none;
      outline: none;
      cursor: pointer;
      font: inherit;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
    }
    
    /* CIRCULAR PEN BUTTON STYLES */
    .pen-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
      transition: transform 0.1s;
      border: 3px solid transparent;
    }
    
    .pen-circle:hover {
      transform: translateY(-2px);
    }
    
    .pen-circle:active {
      transform: translateY(0);
    }
    
    .pen-circle.active {
      border: 3px solid #ffffff;
      box-shadow: 0 0 0 2px #f1c40f, 0 3px 8px rgba(0,0,0,0.3);
    }
    
    #blackPenBtn {
      background: #1a1a1a;
    }
    
    #greenPenBtn {
      background: #27ae60;
    }
    
    #redPenBtn {
      background: #e74c3c;
    }
    
    #highlighterBtn {
      background: #ffeb3b;
    }
    
    #eraserBtn {
      background: #ecf0f1;
    }
    
    .tool-button {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: #1f4b6f;
      color: #ecf0f1;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    }
    .tool-button.square-active {
      width: 40px;
      border-radius: 12px;
      background: var(--toolbar-icon-bg);
      color: #2c3e50;
      border: 2px solid var(--toolbar-icon-border);
      font-size: 18px;
    }
    .tool-button.disabled { opacity: 0.4; cursor: default; pointer-events: none; }

    .pill-button {
      padding: 7px 14px;
      border-radius: var(--radius-pill);
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.35);
    }
    .pill-blue { background: var(--pill-blue); color: #ecf0f1; }
    .pill-red { background: var(--pill-red); color: #ffffff; }
    .pill-purple { background: var(--pill-purple); color: #ecf0f1; }
    .pill-green { background: var(--pill-green); color: #ecf0f1; }
    .pill-orange { background: var(--pill-orange); color: #ffffff; }
    .toolbar-spacer { flex: 1; }

    .wrap-ans {
      display: inline-block;
      max-width: 540px;
      vertical-align: top;
    }

    .hidden { display: none; }
    
    /* Guard note for subtraction lines */
    .subtraction-guard {
      font-size: 14px;
      color: #666;
      margin-top: 8px;
      font-style: italic;
      text-align: center;
    }

    /* ============================================================
      RESPONSIVE BEHAVIOR
    ============================================================ */
    @media (max-width: 1100px) {
      .teacher-examples-container {
        grid-template-columns: 1fr;
      }
      .purple-boxes-container {
        grid-template-columns: 1fr;
      }
      .purple-boxes-container-wide {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 900px) {
      .timer-widget {
        position: static;
        width: 100%;
        max-width: 360px;
        margin-bottom: 14px;
        cursor: default;
      }
      .questions-grid {
        grid-template-columns: 1fr;
        row-gap: 70px;
        column-gap: 0;
      }
      .math, .q-block { font-size: 42px; }
      .q-main { font-size: 42px; }
      .q-sub { font-size: 30px; }
    }
  </style>

  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']] }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <header class="top-bar">
    <div class="top-left">
      <div class="meta-row">
        <span class="meta-label">Date:</span>
        <span class="meta-value">30/12/2025</span>
      </div>
      <div class="meta-row">
        <span class="meta-label">Title:</span>
        <span class="meta-value">Solving Simultaneous Equations by Elimination</span>
      </div>
    </div>

    <div class="top-right">
      <span class="page-info" id="pageInfo">Slide 1 of 16</span>
      <div class="slide-select-wrapper">
        <select class="slide-select" id="slideSelect"></select>
      </div>
    </div>
  </header>

  <main class="content">
    <div id="timerWidget" class="timer-widget hidden">
      <div id="timerDisplay" class="timer-display">01:00</div>
      <div class="timer-controls">
        <button id="timerStart" class="timer-btn">Start</button>
        <button id="timerPause" class="timer-btn">Pause</button>
        <button id="timerReset" class="timer-btn">Reset</button>
      </div>
      <div class="timer-inputs">
        <label>Min: <input id="timerMin" type="number" min="0" max="999" value="1"></label>
        <label>Sec: <input id="timerSec" type="number" min="0" max="59" value="0"></label>
      </div>
    </div>

    <div id="slideMount" style="width:100%; display:flex; flex-direction:column; align-items:center; gap:18px;"></div>

    <canvas id="drawCanvas"></canvas>
  </main>

  <footer class="toolbar">
    <div class="toolbar-left">
      <button id="fullscreenBtn" class="tool-button square-active">‚§¢</button>
      <button id="prevBtn" class="tool-button disabled">‚Üê</button>
      <button id="nextBtn" class="tool-button">‚Üí</button>

      <button id="blackPenBtn" class="pen-circle" title="Black Pen">‚úèÔ∏è</button>
      <button id="greenPenBtn" class="pen-circle" title="Green Pen">‚úèÔ∏è</button>
      <button id="redPenBtn" class="pen-circle" title="Red Pen">‚úèÔ∏è</button>
      <button id="highlighterBtn" class="pen-circle" title="Yellow Highlighter">üñç</button>
      <button id="eraserBtn" class="pen-circle" title="Eraser">‚ö™</button>

      <button id="penSizeBtn" class="pill-button pill-blue">Pen size: Medium ‚ñæ</button>
      <button id="eraserSizeBtn" class="pill-button pill-blue">Eraser size: Medium ‚ñæ</button>
      <button id="clearBtn" class="pill-button pill-red">Clear</button>
    </div>

    <div class="toolbar-spacer"></div>

    <div class="toolbar-right">
    </div>
  </footer>

  <script>
    /* ============================================================
      DOM HOOKS
    ============================================================ */
    const slideMount = document.getElementById('slideMount');
    const slideSelect = document.getElementById('slideSelect');
    const pageInfo = document.getElementById('pageInfo');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');

    const timerWidget = document.getElementById('timerWidget');
    const timerDisplay = document.getElementById('timerDisplay');
    const timerStartBtn = document.getElementById('timerStart');
    const timerPauseBtn = document.getElementById('timerPause');
    const timerResetBtn = document.getElementById('timerReset');
    const timerMinInput = document.getElementById('timerMin');
    const timerSecInput = document.getElementById('timerSec');

    /* ============================================================
      SLIDE TYPE LAYOUT HELPERS
    ============================================================ */
    function renderCoreKnowledge(title, bulletPoints, questionContent, solutionContent, wideBoxes = false) {
      const containerClass = wideBoxes ? 'purple-boxes-container-wide' : 'purple-boxes-container';
      return `
        <section class="core-knowledge-container">
          <div class="core-left">
            <h1>${title}</h1>
            <ul class="bullets">
              ${bulletPoints.map(bullet => `<li>${bullet}</li>`).join('')}
            </ul>
          </div>
          
          <div class="${containerClass}">
            <div class="purple-box">
              <h2>Question</h2>
              <div class="question-content">
                ${questionContent}
              </div>
            </div>
            
            <div class="green-box">
              <h2>Worked Example</h2>
              <div class="worked-solution">
                ${solutionContent}
              </div>
            </div>
          </div>
        </section>
      `;
    }

    function renderTwoColumnExamples(exampleA, exampleB) {
      return `
        <div class="teacher-examples-container">
          <div class="teacher-example-col">
            <h2>${exampleA.title}</h2>
            ${exampleA.content}
          </div>
          <div class="teacher-example-col">
            <h2>${exampleB.title}</h2>
            ${exampleB.content}
          </div>
        </div>
      `;
    }

    /* ============================================================
      SLIDE DECK DATA
    ============================================================ */
    const slides = [
      // Slide 1: Core Knowledge - Eliminating by Subtraction
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Eliminating a Variable by Subtraction',
          [
            'When solving a pair of simultaneous equations, first form a new equation containing one variable.',
            'Identify the variable with the same coefficient, ignoring signs.',
            'If the coefficients have the same sign, subtract one equation from the other.',
            'Write equations vertically with equals signs aligned.'
          ],
          `Obtain a new equation with one variable using the pair of simultaneous equations:<br><br>
          \\(3x + y = 11\\)<br>
          \\(2x + y = 8\\)`,
          
          `<div style="font-family: 'Times New Roman', Times, serif; font-size: 32px; line-height: 1.6; text-align: center; margin-top: 10px;">
            <span style="color: #1f7ed0; font-weight: bold;">‚àí</span>
            \\(
            \\begin{array}{rcl}
            3x + y &=& 11 \\\\
            (2x + y &=& 8) \\\\
            \\hline
            x &=& 3
            \\end{array}
            \\)
          </div>`
        )
      },

      // Slide 2: Examples - Eliminating by Subtraction
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Obtain a new equation with one variable using the pair of simultaneous equations.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 7x + y &= 20 \\\\ 4x + y &= 11 \\end{aligned}\\)
              </div>`
            },
            {
              title: 'Example b)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 9x + 2y &= 30 \\\\ 5x + 2y &= 14 \\end{aligned}\\)
              </div>`
            }
          )}
        `
      },

      // Slide 3: Mini Whiteboard 1 - Eliminating by Subtraction (Questions 1-2)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, form a new equation with one variable.</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">a)</span>
              <span class="math">\\(\\begin{aligned} 4x + y &= 9 \\\\ 2x + y &= 5 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">b)</span>
              <span class="math">\\(\\begin{aligned} 10x + 3y &= 41 \\\\ 6x + 3y &= 25 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 4: Mini Whiteboard 2 - Eliminating by Subtraction (Questions 3-4)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, form a new equation with one variable.</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">c)</span>
              <span class="math">\\(\\begin{aligned} 8x + y &= 17 \\\\ 3x + y &= 7 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">d)</span>
              <span class="math">\\(\\begin{aligned} 12x + 5y &= 49 \\\\ 7x + 5y &= 24 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 5: Core Knowledge - Eliminating by Addition
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Eliminating a Variable by Addition',
          [
            'Identify the variable with the same coefficient in both equations.',
            'If the coefficients have opposite signs, add the equations.',
            'Adding the equations eliminates one variable.'
          ],
          `Obtain a new equation with one variable using the pair of simultaneous equations:<br><br>
          \\(3p + 20q = -7\\)<br>
          \\(2p - 20q = 15\\)`,
          
          `<div style="font-family: 'Times New Roman', Times, serif; font-size: 32px; line-height: 1.6; text-align: center; margin-top: 10px;">
            <span style="color: #1f7ed0; font-weight: bold;">+</span>
            \\(
            \\begin{array}{rcl}
            3p + 20q &=& -7 \\\\
            (2p - 20q &=& 15) \\\\
            \\hline
            5p &=& 8
            \\end{array}
            \\)
          </div>`
        )
      },

      // Slide 6: Examples - Eliminating by Addition
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Obtain a new equation with one variable using the pair of simultaneous equations.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 8x - 6y &= 10 \\\\ 2x + 6y &= 22 \\end{aligned}\\)
              </div>`
            },
            {
              title: 'Example b)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 9p + 4q &= 3 \\\\ 5p - 4q &= 11 \\end{aligned}\\)
              </div>`
            }
          )}
        `
      },

      // Slide 7: Mini Whiteboard 1 - Eliminating by Addition (Questions 1-2)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, form a new equation with one variable.</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">a)</span>
              <span class="math">\\(\\begin{aligned} 7x + 2y &= 15 \\\\ 3x - 2y &= 1 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">b)</span>
              <span class="math">\\(\\begin{aligned} 5a - 4b &= 6 \\\\ 9a + 4b &= 30 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 8: Mini Whiteboard 2 - Eliminating by Addition (Questions 3-4)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, form a new equation with one variable.</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">c)</span>
              <span class="math">\\(\\begin{aligned} 10p - q &= 12 \\\\ 6p + q &= 18 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">d)</span>
              <span class="math">\\(\\begin{aligned} 12m + 7n &= 5 \\\\ 3m - 7n &= 26 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 9: Core Knowledge - Deciding Whether to Add or Subtract
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Deciding Whether to Add or Subtract',
          [
            'Same coefficients and same signs: subtract.',
            'Same coefficients and different signs: add.',
            'This choice eliminates one variable.'
          ],
          `Decide whether to add or subtract the equations to eliminate one variable:<br><br>
          <div style="font-family: 'Times New Roman', Times, serif; font-size: 28px; line-height: 1.8; margin-top: 15px;">
            <strong>a)</strong> 
            \\(
            \\left\\{\\begin{aligned}
            4x - 3y &= 23 \\\\
            2x + 3y &= 19
            \\end{aligned}\\right.
            \\)
          </div>
          <div style="height: 40px;"></div>
          <div style="font-family: 'Times New Roman', Times, serif; font-size: 28px; line-height: 1.8; margin-top: 15px;">
            <strong>b)</strong> 
            \\(
            \\left\\{\\begin{aligned}
            4x + 3y &= 23 \\\\
            2x + 3y &= 19
            \\end{aligned}\\right.
            \\)
          </div>`,
          
          `<strong>a)</strong> Different signs on \\(y\\) ‚Üí <span style="color: #1f7ed0;">Add</span><br><br>
          <strong>b)</strong> Same signs on \\(y\\) ‚Üí <span style="color: #1f7ed0;">Subtract</span>`
        )
      },

      // Slide 10: Examples - Add or Subtract
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>State whether to add or subtract to eliminate one variable.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 6x + y &= 10 \\\\ 6x - y &= 2 \\end{aligned}\\)
              </div>`
            },
            {
              title: 'Example b)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 4a + 3b &= 19 \\\\ 2a + 3b &= 11 \\end{aligned}\\)
              </div>`
            }
          )}
        `
      },

      // Slide 11: Mini Whiteboard 1 - Add or Subtract (Questions 1-2)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, do you need to add or subtract these equations to eliminate one variable?</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">a)</span>
              <span class="math">\\(\\begin{aligned} 4x + y &= 8 \\\\ 2x + y &= 2 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">b)</span>
              <span class="math">\\(\\begin{aligned} 9a - 3b &= 6 \\\\ 5a + 3b &= 18 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 12: Mini Whiteboard 2 - Add or Subtract (Questions 3-4)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, do you need to add or subtract these equations to eliminate one variable?</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">c)</span>
              <span class="math">\\(\\begin{aligned} 7p + 2q &= 11 \\\\ 3p + 2q &= 3 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">d)</span>
              <span class="math">\\(\\begin{aligned} 6m - 5n &= 4 \\\\ 2m + 5n &= 16 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 13: Core Knowledge - Scaling Equations
      {
        timer: null,
        render: () => renderCoreKnowledge(
          'Core Knowledge: Scaling Equations to Match Coefficients',
          [
            'If coefficients do not match, multiply one or both equations.',
            'Scaling creates matching coefficients.',
            'The equations can then be added or subtracted.'
          ],
          `Find an equation with one variable using the pair of simultaneous equations:<br><br>
          \\(5x + 2y = 20 \\quad ‚ë†\\)<br>
          \\(2x + 4y = 24 \\quad ‚ë°\\)`,
          
          `<span style="color: #000;">Multiply ‚ë† by 2:</span><br>
          <div style="font-family: 'Times New Roman', Times, serif; font-size: 32px; line-height: 1.6; text-align: center; margin-top: 10px;">
            <span style="color: #1f7ed0; font-weight: bold;">‚àí</span>
            \\(
            \\begin{array}{rcl}
            10x + 4y &=& 40 \\\\
            (2x + 4y &=& 24) \\\\
            \\hline
            8x &=& 16
            \\end{array}
            \\)
          </div>`
        )
      },

      // Slide 14: Examples - Scaling Equations
      {
        timer: null,
        render: () => `
          <section class="card example-card">
            <h1>Examples</h1>
            <p>Find an equation with one variable using the pair of simultaneous equations.</p>
          </section>

          ${renderTwoColumnExamples(
            {
              title: 'Example a)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 3x + 2y &= 26 \\\\ 4x - y &= 20 \\end{aligned}\\)
              </div>`
            },
            {
              title: 'Example b)',
              content: `<div style="font-family: 'Times New Roman', Times, serif; font-size: 36px; line-height: 1.5; text-align: center; margin-top: 20px;">
                \\(\\begin{aligned} 2x + 9y &= 69 \\\\ x + 3y &= 24 \\end{aligned}\\)
              </div>`
            }
          )}
        `
      },

      // Slide 15: Mini Whiteboard 1 - Scaling (Questions 1-2)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the simultaneous equations.</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">a)</span>
              <span class="math">\\(\\begin{aligned} 2x + 3y &= 18 \\\\ 6x + y &= 22 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">b)</span>
              <span class="math">\\(\\begin{aligned} 2x + 3y &= 20 \\\\ -x + 2y &= -3 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 16: Mini Whiteboard 2 - Scaling (Questions 3-4)
      {
        timer: { min: 1, sec: 0 },
        render: () => `
          <section class="card example-card">
            <h1>Mini Whiteboards</h1>
            <p><strong>On your whiteboards, solve the simultaneous equations.</strong></p>
          </section>

          <section class="questions-grid">
            <div class="q-block">
              <span class="q-label">c)</span>
              <span class="math">\\(\\begin{aligned} 2x + 3y &= 18 \\\\ 6x - y &= 34 \\end{aligned}\\)</span>
            </div>
            <div class="q-block">
              <span class="q-label">d)</span>
              <span class="math">\\(\\begin{aligned} 2x + 2y &= 2 \\\\ 5x - y &= -13 \\end{aligned}\\)</span>
            </div>
          </section>
        `
      },

      // Slide 17: Final Review
      {
        timer: null,
        render: () => `
          <section class="review-slide">
            <div class="review-title">üìù Core Knowledge Review</div>

            <div class="review-box">
              <strong>Solving simultaneous equations (Elimination method)</strong><br><br>
              ‚Ä¢ Scale equations if needed so coefficients match.<br>
              ‚Ä¢ Eliminate one variable by adding or subtracting.<br>
              ‚Ä¢ Solve to find the first variable.<br>
              ‚Ä¢ Substitute into an original equation to find the second variable.<br>
              ‚Ä¢ State the solution clearly.
            </div>

            <div class="review-box">
              <strong>Worked example</strong>
              <div class="review-example">
                \\(
                \\begin{aligned}
                  3x - 4y &= 6 \\quad \\text{‚ë†} \\\\
                  x + 3y &= 15 \\quad \\text{‚ë°} \\\\[6pt]
                  \\text{multiply ‚ë° by 3:} \\\\
                \\end{aligned}
                \\)
                <div style="margin: 10px 0;">
                  <span style="color: #1f7ed0; font-weight: bold; font-size: 28px;">‚àí</span>
                  \\(
                  \\begin{array}{rcl}
                  3x - 4y &=& 6  \\\\
                  (3x + 9y &=& 45) \\\\
                  \\hline
                  -13y &=& -39
                  \\end{array}
                  \\)
                </div>
                \\(
                \\begin{aligned}
                  \\frac{-13y}{-13} &= \\frac{-39}{-13} \\\\ 
                  y &= 3\\\\[6pt]
                  \\text{substitute into ‚ë°:} \\\\
                  x + 3(3) &= 15 \\\\
                  x + 9 &= 15\\\\
                   - 9 & - 9\\\\
                  x &= 6\\\\[6pt]
                  \\text{solution:} & \\\\
                  \\boxed{x = 6, \\, y = 3}
                \\end{aligned}
                \\)
              </div>
            </div>

            <div class="apply-task">
              <h2>Independent Apply Task</h2>
              <p>Complete all questions on the worksheet showing all working out.</p>
            </div>
          </section>
        `
      }
    ];

    /* ============================================================
      SLIDE NAVIGATION STATE
    ============================================================ */
    const maxSlide = slides.length - 1;
    let currentSlide = 0;

    function buildDropdown() {
      slideSelect.innerHTML = "";
      slides.forEach((_, i) => {
        const opt = document.createElement("option");
        opt.value = String(i);
        opt.textContent = `Slide ${i + 1}`;
        slideSelect.appendChild(opt);
      });
    }
    buildDropdown();

    function updateNavUI() {
      prevBtn.classList.toggle('disabled', currentSlide === 0);
      nextBtn.classList.toggle('disabled', currentSlide === maxSlide);
      pageInfo.textContent = `Slide ${currentSlide + 1} of ${maxSlide + 1}`;
      slideSelect.value = String(currentSlide);
    }

    function renderSlide() {
      const t = slides[currentSlide].timer;
      if (t) {
        timerWidget.classList.remove('hidden');
        setTimerTo(t.min, t.sec);
      } else {
        timerWidget.classList.add('hidden');
        pauseTimer();
      }

      slideMount.innerHTML = slides[currentSlide].render();
      if (window.MathJax?.typesetPromise) MathJax.typesetPromise();
      updateNavUI();
      resizeCanvas();
      restoreDrawingForSlide(currentSlide);
    }

    function changeSlideTo(target) {
      if (target < 0 || target > maxSlide) return;
      saveCurrentSlideDrawing();
      currentSlide = target;
      renderSlide();
    }

    prevBtn.addEventListener('click', () => changeSlideTo(currentSlide - 1));
    nextBtn.addEventListener('click', () => changeSlideTo(currentSlide + 1));
    slideSelect.addEventListener('change', (e) => changeSlideTo(parseInt(e.target.value, 10) || 0));

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') { e.preventDefault(); changeSlideTo(currentSlide - 1); }
      if (e.key === 'ArrowRight') { e.preventDefault(); changeSlideTo(currentSlide + 1); }
    });

    /* ============================================================
      DRAWING SYSTEM
    ============================================================ */
    const canvas = document.getElementById('drawCanvas');
    const contentEl = document.querySelector('.content');
    const ctx = canvas.getContext('2d');

    const blackPenBtn = document.getElementById('blackPenBtn');
    const greenPenBtn = document.getElementById('greenPenBtn');
    const redPenBtn = document.getElementById('redPenBtn');
    const highlighterBtn = document.getElementById('highlighterBtn');
    const eraserBtn = document.getElementById('eraserBtn');

    const penSizeBtn = document.getElementById('penSizeBtn');
    const eraserSizeBtn = document.getElementById('eraserSizeBtn');
    const clearBtn = document.getElementById('clearBtn');

    let drawingEnabled = false;
    let isDrawing = false;
    let currentTool = 'pen';
    let currentColor = '#1a1a1a';

    const slideDrawings = new Array(slides.length).fill(null);

    const penSizes = [
      { label: 'Small', value: 2 },
      { label: 'Medium', value: 4 },
      { label: 'Large', value: 8 }
    ];
    const eraserSizes = [
      { label: 'Small', value: 10 },
      { label: 'Medium', value: 20 },
      { label: 'Large', value: 40 }
    ];
    const highlighterSize = 30;
    
    let penSizeIndex = 1;
    let eraserSizeIndex = 1;

    function currentPenSize() { return penSizes[penSizeIndex].value; }
    function currentEraserSize() { return eraserSizes[eraserSizeIndex].value; }

    function updateSizeLabels() {
      penSizeBtn.textContent = `Pen size: ${penSizes[penSizeIndex].label} ‚ñæ`;
      eraserSizeBtn.textContent = `Eraser size: ${eraserSizes[eraserSizeIndex].label} ‚ñæ`;
    }
    updateSizeLabels();

    function enableDrawing(enable) {
      drawingEnabled = enable;
      canvas.style.pointerEvents = enable ? 'auto' : 'none';
    }

    function setActiveToolButton(btn) {
      [blackPenBtn, greenPenBtn, redPenBtn, highlighterBtn, eraserBtn].forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');
    }

    blackPenBtn.addEventListener('click', () => {
      currentTool = 'pen';
      currentColor = '#1a1a1a';
      enableDrawing(true);
      setActiveToolButton(blackPenBtn);
    });

    greenPenBtn.addEventListener('click', () => {
      currentTool = 'pen';
      currentColor = '#27ae60';
      enableDrawing(true);
      setActiveToolButton(greenPenBtn);
    });

    redPenBtn.addEventListener('click', () => {
      currentTool = 'pen';
      currentColor = '#e74c3c';
      enableDrawing(true);
      setActiveToolButton(redPenBtn);
    });

    highlighterBtn.addEventListener('click', () => {
      currentTool = 'highlighter';
      currentColor = '#ffeb3b';
      enableDrawing(true);
      setActiveToolButton(highlighterBtn);
    });

    eraserBtn.addEventListener('click', () => {
      currentTool = 'eraser';
      enableDrawing(true);
      setActiveToolButton(eraserBtn);
    });

    penSizeBtn.addEventListener('click', () => {
      penSizeIndex = (penSizeIndex + 1) % penSizes.length;
      updateSizeLabels();
    });

    eraserSizeBtn.addEventListener('click', () => {
      eraserSizeIndex = (eraserSizeIndex + 1) % eraserSizes.length;
      updateSizeLabels();
    });

    clearBtn.addEventListener('click', () => {
      clearCanvas();
      slideDrawings[currentSlide] = null;
    });

    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    function saveCurrentSlideDrawing() {
      slideDrawings[currentSlide] = canvas.toDataURL('image/png');
    }

    function restoreDrawingForSlide(index) {
      ctx.globalCompositeOperation = 'source-over';
      clearCanvas();
      const dataUrl = slideDrawings[index];
      if (!dataUrl) return;
      const img = new Image();
      img.onload = () => {
        ctx.globalCompositeOperation = 'source-over';
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      };
      img.src = dataUrl;
    }

    function resizeCanvas() {
      const rect = contentEl.getBoundingClientRect();
      canvas.width = rect.width;
      canvas.height = rect.height;
      restoreDrawingForSlide(currentSlide);
    }
    window.addEventListener('resize', resizeCanvas);

    function startDraw(x, y) {
      if (!drawingEnabled) return;
      isDrawing = true;
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    function drawLine(x, y) {
      if (!isDrawing) return;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';

      if (currentTool === 'eraser') {
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = currentEraserSize();
        ctx.globalAlpha = 1.0;
      } else if (currentTool === 'highlighter') {
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 0.3;
        ctx.strokeStyle = '#ffeb3b';
        ctx.lineWidth = highlighterSize;
      } else {
        ctx.globalCompositeOperation = 'source-over';
        ctx.globalAlpha = 1.0;
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = currentPenSize();
      }
      ctx.lineTo(x, y);
      ctx.stroke();
    }

    function stopDraw() {
      if (!isDrawing) return;
      isDrawing = false;
      ctx.closePath();
      saveCurrentSlideDrawing();
    }

    canvas.addEventListener('mousedown', (e) => {
      const rect = canvas.getBoundingClientRect();
      startDraw(e.clientX - rect.left, e.clientY - rect.top);
    });
    canvas.addEventListener('mousemove', (e) => {
      const rect = canvas.getBoundingClientRect();
      drawLine(e.clientX - rect.left, e.clientY - rect.top);
    });
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('mouseleave', stopDraw);

    canvas.addEventListener('touchstart', (e) => {
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      startDraw(touch.clientX - rect.left, touch.clientY - rect.top);
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener('touchmove', (e) => {
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      drawLine(touch.clientX - rect.left, touch.clientY - rect.top);
      e.preventDefault();
    }, { passive: false });

    canvas.addEventListener('touchend', stopDraw);
    canvas.addEventListener('touchcancel', stopDraw);

    /* ============================================================
      TIMER SYSTEM
    ============================================================ */
    let timerInterval = null;
    let timerRemainingSeconds = 60;
    let timerSetSeconds = 60;

    function clamp(num, min, max) { return Math.min(max, Math.max(min, num)); }
    function pad2(n) { return String(n).padStart(2, '0'); }

    function renderTimer() {
      const m = Math.floor(timerRemainingSeconds / 60);
      const s = timerRemainingSeconds % 60;
      timerDisplay.textContent = `${pad2(m)}:${pad2(s)}`;
    }

    function readInputsAsSeconds() {
      const min = clamp(parseInt(timerMinInput.value, 10) || 0, 0, 999);
      const sec = clamp(parseInt(timerSecInput.value, 10) || 0, 0, 59);
      timerMinInput.value = String(min);
      timerSecInput.value = String(sec);
      return (min * 60) + sec;
    }

    function stopTimerInterval() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function startTimer() {
      const inputSeconds = readInputsAsSeconds();
      const shouldUseInputs =
        timerRemainingSeconds === 0 ||
        timerRemainingSeconds === timerSetSeconds;

      if (shouldUseInputs) {
        timerSetSeconds = inputSeconds || 0;
        timerRemainingSeconds = timerSetSeconds;
      }

      stopTimerInterval();
      timerInterval = setInterval(() => {
        if (timerRemainingSeconds > 0) {
          timerRemainingSeconds -= 1;
          renderTimer();
        } else {
          stopTimerInterval();
        }
      }, 1000);

      renderTimer();
    }

    function pauseTimer() { stopTimerInterval(); }

    function resetTimer() {
      stopTimerInterval();
      timerRemainingSeconds = timerSetSeconds;
      timerMinInput.value = String(Math.floor(timerSetSeconds / 60));
      timerSecInput.value = String(timerSetSeconds % 60);
      renderTimer();
    }

    function setTimerTo(min, sec) {
      stopTimerInterval();
      min = clamp(parseInt(min, 10) || 0, 0, 999);
      sec = clamp(parseInt(sec, 10) || 0, 0, 59);

      timerMinInput.value = String(min);
      timerSecInput.value = String(sec);

      timerSetSeconds = (min * 60) + sec;
      timerRemainingSeconds = timerSetSeconds;
      renderTimer();
    }

    timerStartBtn.addEventListener('click', startTimer);
    timerPauseBtn.addEventListener('click', pauseTimer);
    timerResetBtn.addEventListener('click', resetTimer);

    function onInputsChanged() {
      const secs = readInputsAsSeconds();
      timerSetSeconds = secs;
      if (!timerInterval) {
        timerRemainingSeconds = timerSetSeconds;
        renderTimer();
      }
    }
    timerMinInput.addEventListener('input', onInputsChanged);
    timerSecInput.addEventListener('change', onInputsChanged);
    timerSecInput.addEventListener('input', onInputsChanged);
    timerMinInput.addEventListener('change', onInputsChanged);

    renderTimer();

    /* ============================================================
      DRAGGABLE TIMER
    ============================================================ */
    const TIMER_POS_KEY = 'timerWidgetPosition_v3';

    function loadTimerPosition() {
      try {
        const raw = localStorage.getItem(TIMER_POS_KEY);
        if (!raw) return;
        const pos = JSON.parse(raw);
        if (typeof pos?.left !== 'number' || typeof pos?.top !== 'number') return;
        timerWidget.style.left = `${pos.left}px`;
        timerWidget.style.top = `${pos.top}px`;
      } catch {}
    }

    function saveTimerPosition(left, top) {
      localStorage.setItem(TIMER_POS_KEY, JSON.stringify({ left, top }));
    }

    function makeDraggableAbsolute(el, onSave) {
      let dragging = false;
      let offsetX = 0;
      let offsetY = 0;

      el.addEventListener('mousedown', (e) => {
        const tag = e.target.tagName.toLowerCase();
        if (tag === 'input' || tag === 'button') return;

        dragging = true;
        const rect = el.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        e.preventDefault();
      });

      window.addEventListener('mousemove', (e) => {
        if (!dragging) return;
        const parentRect = contentEl.getBoundingClientRect();

        let left = e.clientX - parentRect.left - offsetX;
        let top = e.clientY - parentRect.top - offsetY;

        left = clamp(left, 0, parentRect.width - el.offsetWidth);
        top = clamp(top, 0, parentRect.height - el.offsetHeight);

        el.style.left = `${left}px`;
        el.style.top = `${top}px`;
      });

      window.addEventListener('mouseup', () => {
        if (!dragging) return;
        dragging = false;
        const left = parseFloat(el.style.left) || 0;
        const top = parseFloat(el.style.top) || 0;
        if (onSave) onSave(left, top);
      });
    }

    loadTimerPosition();
    makeDraggableAbsolute(timerWidget, saveTimerPosition);

    /* ============================================================
      FULLSCREEN
    ============================================================ */
    const fullscreenBtn = document.getElementById('fullscreenBtn');
    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });

    /* ============================================================
      INIT
    ============================================================ */
    renderSlide();
  </script>
</body>
</html>
